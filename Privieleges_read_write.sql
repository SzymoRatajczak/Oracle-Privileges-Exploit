-- Access to the system files  is achieved with the privileges of the Oracle user
--so anything what this user can read or write can be written or read by someone else 
--The following PL/SQL code code can be used to read files from the file system

Create or replace procedure READ_FILE(DIRNAME varchar2,FNAME varchar2  )
AS 
invalid_path  EXCEPTION;
access_denied EXCEPTION;
PRAGMA EXCEPTION_INIT(invalid_path,-29280);
PRAGMA EXCEPTION_INIT(access_denied,-29289);
FD UTL_FILE.FILE_TYPE;
BUFFER varchar2(260);
BEGIN
 EXECUTE IMMEDIATE 'CREATE or replace directory RW_FIEL as  ' ' ' || DIRNAME || '''';
 FD:=UTL_FILE.FOPEN('RW_FILE',FNAME,'r');
 DBMS_OUTPUT.ENABLE(1000000);
 LOOP
   UTL_FILE.GET_LINE(FD,BUFFER,254);
   DBMS_OUTPUT.PUT_LINE(BUFFER);
 END LOOP
 EXECUTE IMMEDIATE 'DROP DIRECTORY RW_FILE';
 
 EXCEPTION when invalid_path then
 DBMS_OUTPUT.PUT_LINE('FILE LOCATION or path is invalid');
if(UTL_FILE.IS_OPEN(FD)=TRUE )then
UTL_FILE.FCLOSE(FD);
END IF
EXECUTE IMMEDIATE 'DROP DIRECTORY RW_FILE';

WHEN access_denied then 
DBMS_OUTPUT.PUT_LINE('Access is denied');
IF(UTL_FILE.IS_OPEN(FD)=true) then
UTL_FILE.FCLOSE(FD);
END IF

EXECUTE IMMEDIATE 'DROP DIRECTORY  RW_FILE';
WHEN NO_DATA FOUND  THEN
 DBMS_OUTPUT.PUT_LINE('END of file');
 if(UTL_FILE.IS_OPEN(FD)=TRUE )THEN
 
 UTL_FILE.FCLOSE(FD);
 
 END if
 
 EXECUTE IMMEDIATE 'DROP DIRECTORY RW_FILE';
 WHEN OTHER THEN 
 if(UTL_FILE.IS_OPEN(FD)=TRUE) THEN
 UTL_FILE.FCLOSE(FD);
 END if
 
 DBMS_OUTPUT.PUT_LINE('THere was an error');
 
 EXECUTE IMMEDIATE 'DROP DIRECTORY RW_FILE';
 
 
 END;
 
 
